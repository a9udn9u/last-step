"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
class ProcessResult {
    constructor(importFiles = [], targetFile = undefined) {
        this.importFiles = new Set(importFiles);
        this.targetFile = targetFile;
    }
    get imports() {
        return this.importFiles;
    }
    get target() {
        return this.targetFile;
    }
}
exports.ProcessResult = ProcessResult;
class ProcessorIOEntry {
    constructor(source, target) {
        this.source = source;
        this.target = target;
    }
}
class ProcessorInputEntry extends ProcessorIOEntry {
    constructor(source, target, shouldCompile = false, lastOutput = undefined) {
        super(source, target);
        this.shouldCompile = shouldCompile;
        this.lastOutput = lastOutput;
    }
}
exports.ProcessorInputEntry = ProcessorInputEntry;
class ProcessorOutputEntry extends ProcessorIOEntry {
    constructor(source, target, contains = new Set()) {
        super(source, target);
        this.contains = contains;
    }
}
exports.ProcessorOutputEntry = ProcessorOutputEntry;
class ProcessorIO {
    constructor(sourceDir, workDir) {
        this.bySourceMap = new Map();
        this.byTargetMap = new Map();
        this.sourceDirProp = sourceDir;
        this.workDirProp = workDir;
    }
    add(entry) {
        this.bySourceMap.set(path.relative(this.sourceDir, entry.source), entry);
        this.byTargetMap.set(path.relative(this.workDir, entry.target), entry);
    }
    hasSource(key) {
        return this.bySourceMap.has(key);
    }
    getBySource(key) {
        return this.bySourceMap.get(key);
    }
    hasTarget(key) {
        return this.byTargetMap.has(key);
    }
    getByTarget(key) {
        return this.byTargetMap.get(key);
    }
    *values() {
        yield* this.bySourceMap.values();
    }
    *targetEntries() {
        yield* this.byTargetMap.entries();
    }
    *sourceEntries() {
        yield* this.bySourceMap.entries();
    }
    get sources() {
        return [...this.values()].map(entry => entry.source);
    }
    get targets() {
        return [...this.values()].map(entry => entry.target);
    }
    get sourceDir() {
        return this.sourceDirProp;
    }
    get workDir() {
        return this.workDirProp;
    }
}
class ProcessorInput extends ProcessorIO {
}
exports.ProcessorInput = ProcessorInput;
class ProcessorOutput extends ProcessorIO {
    constructor() {
        super(...arguments);
        this.failures = [];
    }
}
exports.ProcessorOutput = ProcessorOutput;
class FinalizerInput {
    constructor() {
        this.sourceSet = new Set();
    }
    add(source) {
        this.sourceSet.add(source);
    }
    *values() {
        yield* this.sourceSet.values();
    }
    get sources() {
        return [...this.sourceSet];
    }
}
exports.FinalizerInput = FinalizerInput;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc29yLW1vZGVscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbHMvcHJvY2Vzc29yLW1vZGVscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDZCQUE2QjtBQUU3QjtJQUlFLFlBQVksY0FBd0IsRUFBRSxFQUFFLGFBQXFCLFNBQVM7UUFDcEUsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDMUIsQ0FBQztJQUVELElBQUksTUFBTTtRQUNSLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7Q0FDRjtBQWhCRCxzQ0FnQkM7QUFFRDtJQUlFLFlBQVksTUFBYyxFQUFFLE1BQWM7UUFDeEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdkIsQ0FBQztDQUNGO0FBRUQseUJBQWlDLFNBQVEsZ0JBQWdCO0lBSXZELFlBQVksTUFBYyxFQUFFLE1BQWMsRUFBRSxnQkFBeUIsS0FBSyxFQUFFLGFBQW1DLFNBQVM7UUFDdEgsS0FBSyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDO0NBQ0Y7QUFURCxrREFTQztBQUVELDBCQUFrQyxTQUFRLGdCQUFnQjtJQUl4RCxZQUFZLE1BQWMsRUFBRSxNQUFjLEVBQUUsV0FBd0IsSUFBSSxHQUFHLEVBQUU7UUFDM0UsS0FBSyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN0QixJQUFJ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O0lBRUQsQ0FBQyxNQUFNO1FBQ0wsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDN0IsQ0FBQztDQUNGO0FBbkJELHdDQW1CQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBjbGFzcyBQcm9jZXNzUmVzdWx0IHtcbiAgcHJpdmF0ZSBpbXBvcnRGaWxlczogU2V0PHN0cmluZz47XG4gIHByaXZhdGUgdGFyZ2V0RmlsZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGltcG9ydEZpbGVzOiBzdHJpbmdbXSA9IFtdLCB0YXJnZXRGaWxlOiBzdHJpbmcgPSB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmltcG9ydEZpbGVzID0gbmV3IFNldChpbXBvcnRGaWxlcyk7XG4gICAgdGhpcy50YXJnZXRGaWxlID0gdGFyZ2V0RmlsZTtcbiAgfVxuXG4gIGdldCBpbXBvcnRzKCk6IFNldDxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5pbXBvcnRGaWxlcztcbiAgfVxuXG4gIGdldCB0YXJnZXQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy50YXJnZXRGaWxlO1xuICB9XG59XG5cbmNsYXNzIFByb2Nlc3NvcklPRW50cnkge1xuICBzb3VyY2U6IHN0cmluZztcbiAgdGFyZ2V0OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Ioc291cmNlOiBzdHJpbmcsIHRhcmdldDogc3RyaW5nKSB7XG4gICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2Nlc3NvcklucHV0RW50cnkgZXh0ZW5kcyBQcm9jZXNzb3JJT0VudHJ5IHtcbiAgc2hvdWxkQ29tcGlsZTogYm9vbGVhbjtcbiAgbGFzdE91dHB1dDogUHJvY2Vzc29yT3V0cHV0RW50cnk7XG5cbiAgY29uc3RydWN0b3Ioc291cmNlOiBzdHJpbmcsIHRhcmdldDogc3RyaW5nLCBzaG91bGRDb21waWxlOiBib29sZWFuID0gZmFsc2UsIGxhc3RPdXRwdXQ6IFByb2Nlc3Nvck91dHB1dEVudHJ5ID0gdW5kZWZpbmVkKSB7XG4gICAgc3VwZXIoc291cmNlLCB0YXJnZXQpO1xuICAgIHRoaXMuc2hvdWxkQ29tcGlsZSA9IHNob3VsZENvbXBpbGU7XG4gICAgdGhpcy5sYXN0T3V0cHV0ID0gbGFzdE91dHB1dDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUHJvY2Vzc29yT3V0cHV0RW50cnkgZXh0ZW5kcyBQcm9jZXNzb3JJT0VudHJ5IHtcbiAgY29udGFpbnM6IFNldDxzdHJpbmc+O1xuICBpbXBvcnRlZDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3Rvcihzb3VyY2U6IHN0cmluZywgdGFyZ2V0OiBzdHJpbmcsIGNvbnRhaW5zOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKSkge1xuICAgIHN1cGVyKHNvdXJjZSwgdGFyZ2V0KTtcbiAgICB0aGlzLmNvbnRhaW5zID0gY29udGFpbnM7XG4gIH1cbn1cblxuY2xhc3MgUHJvY2Vzc29ySU88VCBleHRlbmRzIFByb2Nlc3NvcklPRW50cnk+IHtcbiAgcHJpdmF0ZSBieVNvdXJjZU1hcDogTWFwPHN0cmluZywgVD47XG4gIHByaXZhdGUgYnlUYXJnZXRNYXA6IE1hcDxzdHJpbmcsIFQ+O1xuICBwcml2YXRlIHNvdXJjZURpclByb3A6IHN0cmluZztcbiAgcHJpdmF0ZSB3b3JrRGlyUHJvcDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHNvdXJjZURpcjogc3RyaW5nLCB3b3JrRGlyOiBzdHJpbmcpIHtcbiAgICB0aGlzLmJ5U291cmNlTWFwID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuYnlUYXJnZXRNYXAgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5zb3VyY2VEaXJQcm9wID0gc291cmNlRGlyO1xuICAgIHRoaXMud29ya0RpclByb3AgPSB3b3JrRGlyO1xuICB9XG5cbiAgYWRkKGVudHJ5OiBUKTogdm9pZCB7XG4gICAgdGhpcy5ieVNvdXJjZU1hcC5zZXQocGF0aC5yZWxhdGl2ZSh0aGlzLnNvdXJjZURpciwgZW50cnkuc291cmNlKSwgZW50cnkpO1xuICAgIHRoaXMuYnlUYXJnZXRNYXAuc2V0KHBhdGgucmVsYXRpdmUodGhpcy53b3JrRGlyLCBlbnRyeS50YXJnZXQpLCBlbnRyeSk7XG4gIH1cblxuICBoYXNTb3VyY2Uoa2V5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5ieVNvdXJjZU1hcC5oYXMoa2V5KTtcbiAgfVxuXG4gIGdldEJ5U291cmNlKGtleTogc3RyaW5nKTogVCB7XG4gICAgcmV0dXJuIHRoaXMuYnlTb3VyY2VNYXAuZ2V0KGtleSk7XG4gIH1cblxuICBoYXNUYXJnZXQoa2V5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5ieVRhcmdldE1hcC5oYXMoa2V5KTtcbiAgfVxuXG4gIGdldEJ5VGFyZ2V0KGtleTogc3RyaW5nKTogVCB7XG4gICAgcmV0dXJuIHRoaXMuYnlUYXJnZXRNYXAuZ2V0KGtleSk7XG4gIH1cblxuICAqdmFsdWVzKCk6IEl0ZXJhYmxlPFQ+IHtcbiAgICB5aWVsZCogdGhpcy5ieVNvdXJjZU1hcC52YWx1ZXMoKTtcbiAgfVxuXG4gICp0YXJnZXRFbnRyaWVzKCk6IEl0ZXJhYmxlPFtzdHJpbmcsIFRdPiB7XG4gICAgeWllbGQqIHRoaXMuYnlUYXJnZXRNYXAuZW50cmllcygpO1xuICB9XG5cbiAgKnNvdXJjZUVudHJpZXMoKTogSXRlcmFibGU8W3N0cmluZywgVF0+IHtcbiAgICB5aWVsZCogdGhpcy5ieVNvdXJjZU1hcC5lbnRyaWVzKCk7XG4gIH1cblxuICBnZXQgc291cmNlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLnZhbHVlcygpXS5tYXAoZW50cnkgPT4gZW50cnkuc291cmNlKTtcbiAgfVxuXG4gIGdldCB0YXJnZXRzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMudmFsdWVzKCldLm1hcChlbnRyeSA9PiBlbnRyeS50YXJnZXQpO1xuICB9XG5cbiAgZ2V0IHNvdXJjZURpcigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnNvdXJjZURpclByb3A7XG4gIH1cblxuICBnZXQgd29ya0RpcigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLndvcmtEaXJQcm9wO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQcm9jZXNzb3JJbnB1dCBleHRlbmRzIFByb2Nlc3NvcklPPFByb2Nlc3NvcklucHV0RW50cnk+IHtcbn1cblxuZXhwb3J0IGNsYXNzIFByb2Nlc3Nvck91dHB1dCBleHRlbmRzIFByb2Nlc3NvcklPPFByb2Nlc3Nvck91dHB1dEVudHJ5PiB7XG4gIGZhaWx1cmVzOiBzdHJpbmdbXSA9IFtdO1xufVxuXG5leHBvcnQgY2xhc3MgRmluYWxpemVySW5wdXQge1xuICBwcml2YXRlIHNvdXJjZVNldDogU2V0PHN0cmluZz47XG4gIHNvdXJjZURpcjogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc291cmNlU2V0ID0gbmV3IFNldCgpO1xuICB9XG5cbiAgYWRkKHNvdXJjZTogc3RyaW5nKSB7XG4gICAgdGhpcy5zb3VyY2VTZXQuYWRkKHNvdXJjZSk7XG4gIH1cblxuICAqdmFsdWVzKCk6IEl0ZXJhYmxlPHN0cmluZz4ge1xuICAgIHlpZWxkKiB0aGlzLnNvdXJjZVNldC52YWx1ZXMoKTtcbiAgfVxuXG4gIGdldCBzb3VyY2VzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuc291cmNlU2V0XTtcbiAgfVxufVxuXG4iXX0=